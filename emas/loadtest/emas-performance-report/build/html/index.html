

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Siyavula performance tuning report &mdash; EMAS Performance Tuning Report 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/upfrontsystems.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="EMAS Performance Tuning Report 1.0 documentation" href="#" /> 
  </head>
  <body>
<div id="portal-header">
    <a href="index.html" id="portal-logo">
        <img class="logo" src="_static/headlogo.png" alt="Logo"/>
    </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">EMAS Performance Tuning Report 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Siyavula performance tuning report</a><ul>
<li><a class="reference internal" href="#pre-test-optimisation">1. Pre-test optimisation</a></li>
<li><a class="reference internal" href="#an-overview-of-the-setup-we-benchmarked">2. An overview of the setup we benchmarked</a></li>
<li><a class="reference internal" href="#testing-authenticated-reads">3. Testing authenticated reads</a></li>
<li><a class="reference internal" href="#authenticated-read-test-results">4. Authenticated read test results</a></li>
<li><a class="reference internal" href="#testing-practice-service">5. Testing practice service</a></li>
<li><a class="reference internal" href="#results-for-testing-practice-service">6. Results for testing practice service</a></li>
<li><a class="reference internal" href="#testing-mobile-reads">7. Testing mobile reads</a></li>
<li><a class="reference internal" href="#results-for-testing-mobile-reads">8. Results for testing mobile reads</a></li>
<li><a class="reference internal" href="#recommendation-for-scaling-conclusion">9. Recommendation for scaling / Conclusion</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="siyavula-performance-tuning-report">
<h1>Siyavula performance tuning report<a class="headerlink" href="#siyavula-performance-tuning-report" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pre-test-optimisation">
<h2>1. Pre-test optimisation<a class="headerlink" href="#pre-test-optimisation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>We started the optimisation process by identifying those folders that have
too many objects.  During this investigation we found that MemberServices
and Orders are potential problems.</p>
<p>As a first-pass optimisation MemberServices were moved to a PostgreSQL
implementation and completely removed from the ZODB.</p>
<p>Orders, on the other hand, were not moved out of the ZODB, since the volumes
involved and the amount of times each Order is accessed are well within the
ZODB&#8217;s capacity to handle.  In order to stop bloating of the portal
catalogue we did move orders to their own smaller catalogue though.</p>
</div></blockquote>
</div>
<div class="section" id="an-overview-of-the-setup-we-benchmarked">
<h2>2. An overview of the setup we benchmarked<a class="headerlink" href="#an-overview-of-the-setup-we-benchmarked" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Four distinct servers were used in the benchmarking process. They are:</p>
<p>Siyavula Performance 1</p>
<blockquote>
<div><ul class="simple">
<li>Varnish caching proxy</li>
<li>HAProxy load balancing server</li>
</ul>
</div></blockquote>
<p>Siyavula Performance 2</p>
<blockquote>
<div><ul class="simple">
<li>4 EMAS application server instances</li>
<li>1 ZEO server with Zope Replication Service</li>
<li>1 Redis analytics queue</li>
<li>1 PostgreSQL cluster (initial primary database server)</li>
<li>4 Monassis instances</li>
</ul>
</div></blockquote>
<p>Siyavula Performance 3</p>
<blockquote>
<div><ul class="simple">
<li>4 EMAS application server instances</li>
<li>1 ZEO server with Zope Replication Service</li>
<li>1 Redis analytics queue</li>
<li>1 PostgreSQL cluster (initial secondary database server)</li>
<li>4 Monassis instances</li>
</ul>
</div></blockquote>
<p>Siyavula Performance 4</p>
<blockquote>
<div><ul class="simple">
<li>Load generation server</li>
<li>Host for the Funkload benchmark tests</li>
</ul>
</div></blockquote>
<p>As load generating infrastructure we chose <a class="reference external" href="http://funkload.nuxeo.org">Funkload</a>, since it is written in
Python, tests are very easy to record, customise and run and the reporting
functions are excellent.</p>
</div></blockquote>
</div>
<div class="section" id="testing-authenticated-reads">
<h2>3. Testing authenticated reads<a class="headerlink" href="#testing-authenticated-reads" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Reading all the possible URLs in the site authenticated was deemed
impractical due to the amount of time potentially required to do one
Funkload cycle.  In order to decide which URLs to use for the authenticated
read tests we created a Funkload test that reads all the content
unauthenticated (results available here: <a class="reference external" href="http://197.221.50.101/stats/test_WholeSite-20130726T155429/">Science unauthed read</a>).</p>
<p>Unauthed read setup:</p>
<ul class="simple">
<li>Launched: 2013-07-26 15:54:29</li>
<li>Test: test_wholesite.py WholeSite.test_WholeSite</li>
<li>Target server: <a class="reference external" href="http://qap.everythingscience.co.za">http://qap.everythingscience.co.za</a></li>
<li>Cycles of concurrent users: [1]</li>
<li>Cycle duration: 800s</li>
<li>Apdex: 1.5</li>
</ul>
<p>From this list of URLs we chose the following to benchmark in our
authenticated read:</p>
<ul class="simple">
<li>/</li>
<li>/login</li>
<li>/login_form</li>
<li>grade-12/01-organic-molecules/01-organic-molecules-07.cnxmlplus</li>
<li>grade-10/19-quantitative-aspects-of-chemical-change/19-quantitative-aspects-of-chemical-change-01.cnxmlplus</li>
<li>grade-10/19-quantitative-aspects-of-chemical-change/19-quantitative-aspects-of-chemical-change-06.cnxmlplus</li>
<li>grade-11/04-intermolecular-forces/04-intermolecular-forces-02.cnxmlplus Get grade-11/04-intermolecular-forces/04-intermolecular-forces-02.cnxmlplus</li>
<li>grade-10/05-the-periodic-table/05-the-periodic-table-01.cnxmlplus Get grade-10/05-the-periodic-table/05-the-periodic-table-01.cnxmlplus</li>
<li>grade-10/22-mechanical-energy/22-mechanical-energy-01.cnxmlplus</li>
<li>grade-10/24-units-used-in-the-book/24-units-used-in-the-book-01.cnxmlplus</li>
<li>grade-12/02-organic-macromolecules/02-organic-macromolecules-01.cnxmlplus</li>
<li>grade-12/05-the-chemical-industry/05-the-chemical-industry-02.cnxmlplus</li>
<li>grade-12/08-work-energy-and-power/08-work-energy-and-power-03.cnxmlplus</li>
<li>grade-12/10-colour/10-colour-06.cnxmlplus</li>
<li>grade-12/11-2d-and-3d-wavefronts/11-2d-and-3d-wavefronts-08.cnxmlplus</li>
<li>grade-12/12-wave-nature-of-matter/12-wave-nature-of-matter-01.cnxmlplus</li>
<li>grade-11/13-types-of-reactions/13-types-of-reactions-01.cnxmlplus</li>
<li>grade-11/14-lithosphere/14-lithosphere-01.cnxmlplus</li>
</ul>
<p>The criterium we used to chose the above URLs is simply the performance
in the unauthenticated reading tests.  The pages that are slow during
unauthenticated reading will be even slower during authenticated reading.
Since we are trying to establish a worst-case read scenario this seemed
a pragmatic approach.</p>
<p>We also chose some URLs that seemed to be served quite fast.  This we did
to get some balance to the overall stats for the reading experience.</p>
<p>Authenticated read setup:</p>
<ul class="simple">
<li>Launched: 2013-08-22 14:35:07</li>
<li>From: siyavulap04</li>
<li>Test: test_AuthenticatedRead.py AuthenticatedRead.test_AuthenticatedRead</li>
<li>Target server: <a class="reference external" href="http://qap.everythingscience.co.za">http://qap.everythingscience.co.za</a></li>
<li>Cycles of concurrent users: [100, 250, 500, 750, 1000]</li>
<li>Apdex: 1.5</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="authenticated-read-test-results">
<h2>4. Authenticated read test results<a class="headerlink" href="#authenticated-read-test-results" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Raw results here: <a class="reference external" href="http://197.221.50.101/stats/test_AuthenticatedRead-20130822T143507/">Authenticated read</a></p>
<p>Login is slow</p>
<p>ESI for portal personal toolbar</p>
<p>Point where service delivery degrades badly</p>
<p>What we did about it</p>
</div></blockquote>
</div>
<div class="section" id="testing-practice-service">
<h2>5. Testing practice service<a class="headerlink" href="#testing-practice-service" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In order to test the Intelligent Practise service fully, Carl Scheffler
implemented an &#8216;oracle&#8217; for answers generated from the Monassis data.
This &#8216;oracle&#8217; we then wrapped in an HTTP server when we found that opening
the pickle of all the saved answers to be a huge performance hit in our
Funkload tests.</p>
<p>During the testing we also tested the practice proxy in the Plone
application.  This was done in order to establish if any processing in this
proxy is possibly more of a performance issue than processing in the
external system.  Here are the <a class="reference external" href="http://197.221.50.101/stats/test_practiceproxy-20130819T124350/">Practice proxy</a> results.  To test this we
recorded a Funkload test that logs in to the site and then navigates to a
simple view in Monassis.  This view does no processing beyond returning
basic headers and &#8216;OK&#8217;.</p>
<p>For the full practise service test we recorded a Funkload test that logs in
to the site, browses to the practise service and then does 10 questions.
The answers to these questions are fetched from the &#8216;oracle&#8217; HTTP server.</p>
<p>We used the following test configuration:</p>
<ul class="simple">
<li>Launched: 2013-08-23 12:10:13</li>
<li>From: siyavulap04</li>
<li>Test: test_Practice.py Practice.test_practice</li>
<li>Target server: <a class="reference external" href="http://qap.everythingmaths.co.za">http://qap.everythingmaths.co.za</a></li>
<li>Cycles of concurrent users: [100, 150, 200]</li>
<li>Apdex: 1.5</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="results-for-testing-practice-service">
<h2>6. Results for testing practice service<a class="headerlink" href="#results-for-testing-practice-service" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Raw results here: <a class="reference external" href="http://197.221.50.101/stats/test_practice-20130823T121013/">Practise service test</a></div></blockquote>
</div>
<div class="section" id="testing-mobile-reads">
<h2>7. Testing mobile reads<a class="headerlink" href="#testing-mobile-reads" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="results-for-testing-mobile-reads">
<h2>8. Results for testing mobile reads<a class="headerlink" href="#results-for-testing-mobile-reads" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="recommendation-for-scaling-conclusion">
<h2>9. Recommendation for scaling / Conclusion<a class="headerlink" href="#recommendation-for-scaling-conclusion" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">EMAS Performance Tuning Report 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Upfront Systems.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>