
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Siyavula performance tuning report &mdash; EMAS Performance Tuning Report 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/upfrontsystems.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="EMAS Performance Tuning Report 1.0 documentation" href="#" /> 
  </head>
  <body>
<div id="portal-header">
    <a href="index.html" id="portal-logo">
        <img class="logo" src="_static/headlogo.png" alt="Logo"/>
    </a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="#">EMAS Performance Tuning Report 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Siyavula performance tuning report</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#pre-test-optimisation">1. Pre-test optimisation</a></li>
<li><a class="reference internal" href="#an-overview-of-the-setup-we-benchmarked">2. An overview of the setup we benchmarked</a></li>
<li><a class="reference internal" href="#testing-authenticated-reads">3. Testing authenticated reads</a></li>
<li><a class="reference internal" href="#authenticated-read-test-results">4. Authenticated read test results</a><ul>
<li><a class="reference internal" href="#concurrent-users">100 concurrent users</a></li>
<li><a class="reference internal" href="#id2">250 concurrent users</a></li>
<li><a class="reference internal" href="#id3">500 concurrent users</a></li>
<li><a class="reference internal" href="#id4">750 concurrent users</a></li>
<li><a class="reference internal" href="#id5">1000 concurrent users</a></li>
<li><a class="reference internal" href="#optimisations-done">Optimisations done</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-practice-service">5. Testing practice service</a></li>
<li><a class="reference internal" href="#results-for-testing-practice-service">6. Results for testing practice service</a><ul>
<li><a class="reference internal" href="#id6">100 concurrent users</a></li>
<li><a class="reference internal" href="#id7">150 concurrent users</a></li>
<li><a class="reference internal" href="#id8">200 concurrent users</a></li>
<li><a class="reference internal" href="#id9">Optimisations done</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-mobile-authenticated-reads">7. Testing mobile authenticated reads</a></li>
<li><a class="reference internal" href="#results-for-testing-mobile-authenticated-reads">8. Results for testing mobile authenticated reads</a><ul>
<li><a class="reference internal" href="#id10">100 concurrent users</a></li>
<li><a class="reference internal" href="#id11">250 concurrent users</a></li>
<li><a class="reference internal" href="#id12">500 concurrent users</a></li>
<li><a class="reference internal" href="#id13">750 concurrent users</a></li>
<li><a class="reference internal" href="#id14">1000 concurrent users</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-varnish">9. Testing Varnish</a></li>
<li><a class="reference internal" href="#results-of-varnish">10. Results of Varnish</a><ul>
<li><a class="reference internal" href="#user">1 user</a></li>
<li><a class="reference internal" href="#id15">10 concurrent users</a></li>
<li><a class="reference internal" href="#id16">100 concurrent users</a></li>
<li><a class="reference internal" href="#id17">1000 concurrent users</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recommendation-for-scaling-conclusion">Recommendation for scaling / Conclusion</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="siyavula-performance-tuning-report">
<h1>Siyavula performance tuning report<a class="headerlink" href="#siyavula-performance-tuning-report" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In order to test the current configuration, hardware and software, against
the published <a class="reference external" href="https://docs.google.com/a/upfrontsystems.co.za/document/d/1GUjwcpHBpLILQozouukxVQBLB1-GQvdUa6UXfpv75-M/edit#">performance goals</a>, a series of benchmark tests were
undertaken.  The results of these tests were used to do optimisation changes.</p>
<p>This document tries to summarise the data that was gathered, the conclusions
that were reached and the remedial steps that were taken.</p>
<p>Each section has a link to the specific <a class="reference external" href="http://197.221.50.101/stats/">Funkload bench reports</a>.  The
Funkload bench tests were configure not to follow external links, since
we are attempting to benchmark the EMAS software and hardware cluster
not external CDNs or external network access.</p>
</div></blockquote>
</div>
<div class="section" id="pre-test-optimisation">
<h2>1. Pre-test optimisation<a class="headerlink" href="#pre-test-optimisation" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>We started the optimisation process by identifying those folders that have
too many objects.  During this investigation we found that MemberServices
and Orders are potential problems.</p>
<p>As a first-pass optimisation MemberServices were moved to a PostgreSQL
implementation and completely removed from the ZODB.</p>
<p>Orders, on the other hand, were not moved out of the ZODB, since the volumes
involved and the amount of times each Order is accessed are well within the
ZODB&#8217;s capacity to handle.  In order to stop bloating of the portal
catalogue we did move orders to their own smaller catalogue though.</p>
</div></blockquote>
</div>
<div class="section" id="an-overview-of-the-setup-we-benchmarked">
<h2>2. An overview of the setup we benchmarked<a class="headerlink" href="#an-overview-of-the-setup-we-benchmarked" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Four distinct servers were used in the benchmarking process.  Any further
mention of &#8216;test cluster&#8217; in this document refers to the following setup:</p>
<p>Siyavula Performance 1 (aka. SP1)</p>
<blockquote>
<div><ul class="simple">
<li>Varnish caching proxy</li>
<li>HAProxy load balancing server</li>
</ul>
</div></blockquote>
<p>Siyavula Performance 2 (aka. SP2)</p>
<blockquote>
<div><ul class="simple">
<li>4 EMAS application server instances</li>
<li>1 ZEO server with Zope Replication Service</li>
<li>1 Redis analytics queue</li>
<li>1 PostgreSQL cluster (initial primary database server)</li>
<li>4 Monassis instances</li>
</ul>
</div></blockquote>
<p>Siyavula Performance 3 (aka. SP3)</p>
<blockquote>
<div><ul class="simple">
<li>4 EMAS application server instances</li>
<li>1 ZEO server with Zope Replication Service</li>
<li>1 Redis analytics queue</li>
<li>1 PostgreSQL cluster (initial secondary database server)</li>
<li>4 Monassis instances</li>
</ul>
</div></blockquote>
<p>Siyavula Performance 4 (aka. sp4)</p>
<blockquote>
<div><ul class="simple">
<li>Load generation server</li>
<li>Host for the <a class="reference external" href="http://funkload.nuxeo.org">Funkload</a> benchmark tests</li>
</ul>
</div></blockquote>
<p>As load generating infrastructure we chose Funkload, since it is written in
Python, tests are very easy to record, customise and run and the reporting
functions are excellent.</p>
<p>Network topology:
TODO:</p>
</div></blockquote>
</div>
<div class="section" id="testing-authenticated-reads">
<span id="id1"></span><h2>3. Testing authenticated reads<a class="headerlink" href="#testing-authenticated-reads" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Reading all the possible URLs in the site authenticated was deemed
impractical due to the amount of time potentially required to do one
test cycle.  In order to decide which URLs to use for the authenticated
read tests we created a Funkload test that reads all the content
unauthenticated (results available here: <a class="reference external" href="http://197.221.50.101/stats/test_WholeSite-20130726T155429/">Science unauthenticated read</a>).
This test was run with only 1 user and 1 cycle.</p>
<p>Unauthenticated read setup:</p>
<ul class="simple">
<li>Launched: 2013-07-26 15:54:29</li>
<li>Test: test_wholesite.py WholeSite.test_WholeSite</li>
<li>Target server: <a class="reference external" href="http://qap.everythingscience.co.za">http://qap.everythingscience.co.za</a></li>
<li>Cycles of concurrent users: [1]</li>
<li>Cycle duration: 800s</li>
<li><a class="reference external" href="http://apdex.org/">Apdex</a>: 1.5</li>
</ul>
<p>From this list of URLs we chose to benchmark the following in the
authenticated read test:</p>
<ul class="simple">
<li>/</li>
<li>/login</li>
<li>/login_form</li>
<li>grade-12/01-organic-molecules/01-organic-molecules-07.cnxmlplus</li>
<li>grade-10/19-quantitative-aspects-of-chemical-change/19-quantitative-aspects-of-chemical-change-01.cnxmlplus</li>
<li>grade-10/19-quantitative-aspects-of-chemical-change/19-quantitative-aspects-of-chemical-change-06.cnxmlplus</li>
<li>grade-11/04-intermolecular-forces/04-intermolecular-forces-02.cnxmlplus Get grade-11/04-intermolecular-forces/04-intermolecular-forces-02.cnxmlplus</li>
<li>grade-10/05-the-periodic-table/05-the-periodic-table-01.cnxmlplus Get grade-10/05-the-periodic-table/05-the-periodic-table-01.cnxmlplus</li>
<li>grade-10/22-mechanical-energy/22-mechanical-energy-01.cnxmlplus</li>
<li>grade-10/24-units-used-in-the-book/24-units-used-in-the-book-01.cnxmlplus</li>
<li>grade-12/02-organic-macromolecules/02-organic-macromolecules-01.cnxmlplus</li>
<li>grade-12/05-the-chemical-industry/05-the-chemical-industry-02.cnxmlplus</li>
<li>grade-12/08-work-energy-and-power/08-work-energy-and-power-03.cnxmlplus</li>
<li>grade-12/10-colour/10-colour-06.cnxmlplus</li>
<li>grade-12/11-2d-and-3d-wavefronts/11-2d-and-3d-wavefronts-08.cnxmlplus</li>
<li>grade-12/12-wave-nature-of-matter/12-wave-nature-of-matter-01.cnxmlplus</li>
<li>grade-11/13-types-of-reactions/13-types-of-reactions-01.cnxmlplus</li>
<li>grade-11/14-lithosphere/14-lithosphere-01.cnxmlplus</li>
</ul>
<p>The criterium we used to choose the above URLs is simply the performance
in the unauthenticated reading tests.  The pages that are slow during
unauthenticated reading will be even slower during authenticated reading.</p>
<p>We also chose some URLs that seemed to serve quite fast.  This we did to get
some balance to the overall stats for the reading experience.</p>
<p>The resultant Funkload test was run with 4 test cycles ranging from 100
to 1000 concurrent users.</p>
<p>Authenticated read setup:</p>
<ul class="simple">
<li>Launched: 2013-08-22 14:35:07</li>
<li>From: siyavulap04</li>
<li>Test: test_AuthenticatedRead.py AuthenticatedRead.test_AuthenticatedRead</li>
<li>Target server: <a class="reference external" href="http://qap.everythingscience.co.za">http://qap.everythingscience.co.za</a></li>
<li>Cycles of concurrent users: [100, 250, 500, 750, 1000]</li>
<li>Apdex: 1.5</li>
</ul>
<p>The results of each test cycle contains:</p>
<ul class="simple">
<li>18 pages</li>
<li>59 links</li>
<li>99 images</li>
</ul>
<p>The benchmark test as a whole (all cycles and users) contains:</p>
<ul class="simple">
<li>381 tests</li>
<li>9701 pages</li>
<li>100343 requests</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="authenticated-read-test-results">
<h2>4. Authenticated read test results<a class="headerlink" href="#authenticated-read-test-results" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Funkload bench report here: <a class="reference external" href="http://197.221.50.101/stats/test_AuthenticatedRead-20130822T143507/">Authenticated read</a></div></blockquote>
<div class="section" id="concurrent-users">
<h3>100 concurrent users<a class="headerlink" href="#concurrent-users" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Projected serve rate:</div></blockquote>
</div>
<div class="section" id="id2">
<h3>250 concurrent users<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Projected serve rate:</div></blockquote>
</div>
<div class="section" id="id3">
<h3>500 concurrent users<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Load time per page:</p>
<p>Projected serve rate:</p>
</div></blockquote>
</div>
<div class="section" id="id4">
<h3>750 concurrent users<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Load time per page:</p>
<p>Projected serve rate:</p>
</div></blockquote>
</div>
<div class="section" id="id5">
<h3>1000 concurrent users<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Load time per page:</p>
<p>Projected serve rate:</p>
<p>It is quite clear that as the concurrency rises the cluster serves less-
and-less pages per second, but never completely stops working.</p>
</div></blockquote>
</div>
<div class="section" id="optimisations-done">
<h3>Optimisations done<a class="headerlink" href="#optimisations-done" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>During the testing process we realised that some elements in the pages are
causing sub-optimal caching in Varnish.  This is due to elements like
username and personal links which are unique to each authenticated user.
These elements cause Varnish to view pages as different although very little
actually differ between them.</p>
<p>We implemented an <a class="reference external" href="http://en.wikipedia.org/wiki/Edge_Side_Includes">Edge-side include</a> (ESI) for the personal toolbar which
leads to Varnish caching most of the page and only fetching the ESI content.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="testing-practice-service">
<h2>5. Testing practice service<a class="headerlink" href="#testing-practice-service" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In order to test the Intelligent Practise service fully, Carl Scheffler
implemented an &#8216;oracle&#8217; for answers generated from the Monassis data.
This &#8216;oracle&#8217; we then wrapped in an HTTP server when we found that opening
the pickle of all the saved answers to be a huge performance hit in our
<a class="reference external" href="http://funkload.nuxeo.org">Funkload</a> tests.</p>
<p>During the testing we also tested the practice proxy in the Plone
application.  This was done in order to establish if any processing in this
proxy is possibly more of a performance issue than processing in the
external system.  Here are the <a class="reference external" href="http://197.221.50.101/stats/test_practiceproxy-20130819T124350/">Practice proxy</a> results.  To test this we
recorded a <a class="reference external" href="http://funkload.nuxeo.org">Funkload</a> test that logs in to the site and then navigates to a
simple view in Monassis.  This view does no processing beyond returning
basic headers and the string literal &#8216;OK&#8217;.</p>
<p>For the full practise service test we recorded a <a class="reference external" href="http://funkload.nuxeo.org">Funkload</a> test that logs in
to the site, browses to the practise service and then does 10 questions.
The answers to these questions are fetched from the &#8216;oracle&#8217; HTTP server.
This test we then ran with user concurrencies of 100, 150 and 200.</p>
<p>We used the following test configuration:</p>
<ul class="simple">
<li>Launched: 2013-08-23 12:10:13</li>
<li>From: siyavulap04</li>
<li>Test: test_Practice.py Practice.test_practice</li>
<li>Target server: <a class="reference external" href="http://qap.everythingmaths.co.za">http://qap.everythingmaths.co.za</a></li>
<li>Cycles of concurrent users: [100, 150, 200]</li>
<li><a class="reference external" href="http://apdex.org/">Apdex</a>: 1.5</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="results-for-testing-practice-service">
<h2>6. Results for testing practice service<a class="headerlink" href="#results-for-testing-practice-service" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Funkload bench report here: <a class="reference external" href="http://197.221.50.101/stats/test_practice-20130823T121013/">Practise service test</a></div></blockquote>
<div class="section" id="id6">
<h3>100 concurrent users<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Projected serve rates</p>
<p>This gives us a  load time of <strong>40.451 seconds per page at 100
concurrent users.</strong></p>
<p>At this rate we can serve:</p>
<p>(60 / 40.451) * 60 = <strong>88.99 pages per hour.</strong></p>
</div></blockquote>
</div>
<div class="section" id="id7">
<h3>150 concurrent users<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Page load time: <strong>62.589 seconds</strong></p>
<p>(60 / 62.589) * 60 = <strong>57.51 pages per hour.</strong></p>
</div></blockquote>
</div>
<div class="section" id="id8">
<h3>200 concurrent users<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Page load time: <strong>104.25 seconds</strong></p>
<p>(60 / 104.25) * 60 = <strong>34.532 pages per hour.</strong></p>
</div></blockquote>
</div>
<div class="section" id="id9">
<h3>Optimisations done<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>When we analysed the data from the practice service test we realized that
the Plone login process takes quite a bit of time.  Upon further
investigation we found that the user object is updated on each login.
This is unnecessary given that we do not require the last login time.  We
changed that specific method and removed all unnecessary changes to the
user object.</div></blockquote>
</div>
</div>
<div class="section" id="testing-mobile-authenticated-reads">
<h2>7. Testing mobile authenticated reads<a class="headerlink" href="#testing-mobile-authenticated-reads" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Funkload bench report here: <a class="reference external" href="http://197.221.50.101/stats/">Mobile test</a></p>
<p>We used exactly the same set of pages for the mobile authenticated read tests
as those in <a class="reference internal" href="#testing-authenticated-reads"><em>3. Testing authenticated reads</em></a> above.  The tests were run in
2 batches.  The only things different between the 2 batches are the number
of cycles and concurrencies in those cycles.</p>
<p>First batch:</p>
<blockquote>
<div><p>Test setup:</p>
<ul class="simple">
<li>Launched: 2013-09-16 18:35:06</li>
<li>Test: test_AuthenticatedMobileRead.py AuthenticatedMobileRead.test_AuthenticatedMobileRead</li>
<li>Target server: <a class="reference external" href="http://m.qap.everythingscience.co.za">http://m.qap.everythingscience.co.za</a></li>
<li>Cycles of concurrent users: <strong>[100, 250, 500]</strong></li>
<li>Cycle duration: 180s</li>
<li><a class="reference external" href="http://apdex.org/">Apdex</a>: 1.5</li>
</ul>
<p>The results of each test cycle contains:</p>
<ul class="simple">
<li>18 pages</li>
<li>6 links</li>
<li>588 images</li>
</ul>
<p>The benchmark test as a whole (all cycles and users) contains:</p>
<ul class="simple">
<li>19 tests</li>
<li>1485 pages</li>
<li>76088 requests</li>
</ul>
</div></blockquote>
<p>Second batch:</p>
<blockquote>
<div><p>Test setup:</p>
<ul class="simple">
<li>Launched: 2013-09-16 19:38:36</li>
<li>Test: test_AuthenticatedMobileRead.py AuthenticatedMobileRead.test_AuthenticatedMobileRead</li>
<li>Target server: <a class="reference external" href="http://m.qap.everythingscience.co.za">http://m.qap.everythingscience.co.za</a></li>
<li>Cycles of concurrent users: <strong>[750, 1000]</strong></li>
<li>Cycle duration: 180s</li>
<li><a class="reference external" href="http://apdex.org/">Apdex</a>: 1.5</li>
</ul>
<p>The results of each test cycle contains:</p>
<ul class="simple">
<li>18 page(s)</li>
<li>6 link(s)</li>
<li>588 image(s)</li>
</ul>
<p>The benchmark test as a whole (all cycles and users) contains:</p>
<ul class="simple">
<li>18 tests</li>
<li>2156 pages</li>
<li>116041 requests</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="results-for-testing-mobile-authenticated-reads">
<h2>8. Results for testing mobile authenticated reads<a class="headerlink" href="#results-for-testing-mobile-authenticated-reads" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>100 concurrent users<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The page load time:</p>
<p><strong>5.43 seconds per page</strong>.</p>
<p>Projected serve rate for initial mobile home pages load:</p>
<p>(60 / 5.43) * 60 = <strong>662.98 per hour</strong></p>
</div></blockquote>
</div>
<div class="section" id="id11">
<h3>250 concurrent users<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Load time per page:</p>
<p><strong>10.959 seconds</strong></p>
<p>Projected serve rate:</p>
<p>(60 / 10.959) * 60 = <strong>328.49 pages per hour.</strong></p>
</div></blockquote>
</div>
<div class="section" id="id12">
<h3>500 concurrent users<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Load time per page:</p>
<p><strong>20.595 seconds</strong></p>
<p>Projected serve rate:</p>
<p>(60 / 20.595) * 60 = <strong>174.79 pages per hour.</strong></p>
</div></blockquote>
</div>
<div class="section" id="id13">
<h3>750 concurrent users<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Load time per page:</p>
<p><strong>33.025 seconds</strong></p>
<p>Projected serve rate:</p>
<p>(60 / 33.025) * 60 = <strong>109.00 pages per hour.</strong></p>
</div></blockquote>
</div>
<div class="section" id="id14">
<h3>1000 concurrent users<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Load time per page:</p>
<p><strong>69.127 seconds</strong></p>
<p>Projected serve rate:</p>
<p>(60 / 69.127) * 60 = <strong>52.07 pages per hour.</strong></p>
</div></blockquote>
</div>
</div>
<div class="section" id="testing-varnish">
<h2>9. Testing Varnish<a class="headerlink" href="#testing-varnish" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>As background to this test consider the following.  The application servers
SP2 and SP3 are connected via a non-routable private subnet in the 10.0.0.*
range. In the current cluster setup they are accessed over this private
subnet via the HAProxy and Varnish servers on SP1.  This means any latency
or throughput issues on the subnet will adversly affect the total
scalability.</p>
<p>Varnish serves all our cachable resources (CSS, javascript, images, etc.).
In order to understand the total scalability we decided to checked Varnish&#8217;s
scalability in our current cluster setup.</p>
<p>We used <a class="reference external" href="https://httpd.apache.org/docs/2.2/programs/ab.html">Apache Benchmark</a> to test Varnish from our load generating server
and the Varnish/ HAProxy server.  This was done with a script that starts
off with 1 user and 10 requests all the way up to 1000 concurrent users and
1000000 requests.</p>
</div></blockquote>
</div>
<div class="section" id="results-of-varnish">
<h2>10. Results of Varnish<a class="headerlink" href="#results-of-varnish" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user">
<h3>1 user<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="30%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Complete requests</th>
<th class="head">SP1 requests/s</th>
<th class="head">SP4 requests/s</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>100</td>
<td>3799.39</td>
<td>242.94</td>
</tr>
<tr class="row-odd"><td>1000</td>
<td>4672.11</td>
<td>242.47</td>
</tr>
<tr class="row-even"><td>10000</td>
<td>4271.39</td>
<td>242.78</td>
</tr>
<tr class="row-odd"><td>100000</td>
<td>4457.42</td>
<td>243.10</td>
</tr>
<tr class="row-even"><td>1000000</td>
<td>4828.27</td>
<td>242.91</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="id15">
<h3>10 concurrent users<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="30%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Complete requests</th>
<th class="head">SP1 requests/s</th>
<th class="head">SP4 requests/s</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>100</td>
<td>11041.18</td>
<td>356.05</td>
</tr>
<tr class="row-odd"><td>1000</td>
<td>20597.32</td>
<td>356.20</td>
</tr>
<tr class="row-even"><td>10000</td>
<td>21980.24</td>
<td>358.07</td>
</tr>
<tr class="row-odd"><td>100000</td>
<td>18690.17</td>
<td>358.09</td>
</tr>
<tr class="row-even"><td>1000000</td>
<td>20729.00</td>
<td>358.04</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="id16">
<h3>100 concurrent users<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="30%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Complete requests</th>
<th class="head">SP1 requests/s</th>
<th class="head">SP4 requests/s</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>100</td>
<td>9004.95</td>
<td>242.86</td>
</tr>
<tr class="row-odd"><td>1000</td>
<td>17513.13</td>
<td>357.70</td>
</tr>
<tr class="row-even"><td>10000</td>
<td>18031.14</td>
<td>358.10</td>
</tr>
<tr class="row-odd"><td>100000</td>
<td>18753.04</td>
<td>358.13</td>
</tr>
<tr class="row-even"><td>1000000</td>
<td>18552.96</td>
<td>358.13</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="id17">
<h3>1000 concurrent users<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="30%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Complete requests</th>
<th class="head">SP1 requests/s</th>
<th class="head">SP4 requests/s</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>100</td>
<td>no data (1)</td>
<td>no data</td>
</tr>
<tr class="row-odd"><td>1000</td>
<td>10249.79</td>
<td>129.72</td>
</tr>
<tr class="row-even"><td>10000</td>
<td>12786.09</td>
<td>no data</td>
</tr>
<tr class="row-odd"><td>100000</td>
<td>15860.49</td>
<td>no data</td>
</tr>
<tr class="row-even"><td>1000000</td>
<td>16436.69</td>
<td>no data</td>
</tr>
</tbody>
</table>
<p>(1) An entry of &#8216;no data&#8217; indicates that the test cycle could not complete
successfully and therefore <a class="reference external" href="https://httpd.apache.org/docs/2.2/programs/ab.html">Apache Benchmark</a> did not record the statistics.</p>
<p>Both SP1 and SP4 show relatively linear changes in performance.  The important
thing is the marked difference in the amount of requests per second between
the 2 servers.  After more investigation we found that the back-end network
between the servers in the cluster is not running at its full capacity.  This
has been changed and a second set of tests will be run to validate the
assumption that network throughput is responsible for the difference in
performance between the 2 mentioned servers.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="recommendation-for-scaling-conclusion">
<h2>Recommendation for scaling / Conclusion<a class="headerlink" href="#recommendation-for-scaling-conclusion" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="#">EMAS Performance Tuning Report 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Upfront Systems.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>